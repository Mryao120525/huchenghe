# 存储空间管理功能模块

## 功能概述

存储空间管理模块是护橙河三维模型管理系统的重要组成部分，提供了全面的存储空间监控、文件管理和空间清理功能。该模块帮助管理员有效管理系统的存储资源，确保系统稳定运行。

## 主要功能

### 1. 存储空间概览

#### 功能描述
- **总存储空间**: 显示系统总存储容量
- **已用空间**: 显示当前已使用的存储空间
- **可用空间**: 显示剩余可用存储空间
- **文件总数**: 显示系统中文件的总数量
- **使用率进度条**: 直观显示存储空间使用情况

#### 技术实现
- 实时获取磁盘空间信息（支持Windows和Linux系统）
- 递归统计文件总数
- 动态计算使用率百分比
- 颜色编码显示存储状态（绿色<70%，黄色70-90%，红色>90%）

### 2. 文件管理

#### 功能描述
- **文件列表**: 分页显示所有文件信息
- **文件搜索**: 支持按文件名模糊搜索
- **类型筛选**: 按文件类型筛选（模型文件、图片文件、文档文件、其他文件）
- **文件操作**: 支持单个和批量删除、下载文件
- **文件信息**: 显示文件名、类型、大小、创建时间、路径等

#### 技术实现
- 递归扫描存储目录获取文件列表
- 文件类型自动识别（基于文件扩展名）
- 分页查询优化性能
- 文件路径安全验证，防止越权访问

#### 支持的文件类型
- **模型文件**: .obj, .fbx, .dae, .3ds, .max, .blend
- **图片文件**: .jpg, .jpeg, .png, .gif, .bmp, .tiff, .webp
- **文档文件**: .pdf, .doc, .docx, .txt, .rtf, .odt
- **其他文件**: 未分类的文件类型

### 3. 空间清理

#### 功能描述
- **临时文件清理**: 清理系统生成的临时文件和缓存
- **重复文件清理**: 清理内容相同但文件名不同的重复文件
- **过期文件清理**: 清理超过指定时间的旧文件
- **空文件夹清理**: 清理不包含任何文件的空文件夹
- **快速清理**: 一键清理临时文件和空文件夹

#### 技术实现
- 智能扫描算法识别可清理文件
- 文件内容哈希比对检测重复文件
- 时间戳比对识别过期文件
- 递归扫描检测空文件夹
- 安全的文件删除操作

### 4. 存储设置

#### 功能描述
- **存储路径配置**: 设置文件存储的根目录
- **自动清理**: 启用/禁用自动清理功能
- **清理周期**: 设置自动清理的执行频率（每天/每周/每月）
- **文件保留天数**: 设置文件的保留期限
- **存储警告阈值**: 设置存储空间使用率警告阈值

## API接口

### 存储空间信息
```javascript
GET /api/storage/info
```
获取存储空间使用情况统计信息。

### 文件管理
```javascript
GET /api/storage/files?page=1&pageSize=20&search=&type=all
```
获取文件列表，支持分页、搜索和类型筛选。

```javascript
DELETE /api/storage/files/:fileId
```
删除指定文件。

```javascript
DELETE /api/storage/files/batch-delete
```
批量删除文件。

```javascript
GET /api/storage/files/:fileId/download
```
下载指定文件。

### 空间清理
```javascript
GET /api/storage/cleanup/scan
```
扫描可清理的文件。

```javascript
POST /api/storage/cleanup/execute
```
执行清理操作。

```javascript
POST /api/storage/cleanup/quick
```
执行快速清理。

### 存储设置
```javascript
GET /api/storage/settings
```
获取存储设置。

```javascript
PUT /api/storage/settings
```
更新存储设置。

### 统计信息
```javascript
GET /api/storage/stats/file-types
```
获取文件类型统计信息。

## 前端组件

### StorageManagement.vue
主要的存储空间管理页面组件，包含：
- 存储空间概览卡片
- 文件管理表格
- 空间清理工具
- 响应式布局设计

### 主要特性
- **实时数据**: 所有数据实时从后端API获取
- **用户友好**: 直观的界面设计和操作反馈
- **安全操作**: 删除操作需要确认，防止误操作
- **进度显示**: 清理操作显示进度和结果
- **错误处理**: 完善的错误处理和用户提示

## 后端实现

### storageRoutes.js
存储空间管理的后端路由模块，提供：
- 文件系统操作
- 磁盘空间监控
- 安全验证
- 错误处理

### 核心功能
- **跨平台支持**: 支持Windows和Linux系统
- **安全验证**: 文件路径验证，防止越权访问
- **性能优化**: 异步操作，避免阻塞
- **错误处理**: 完善的异常处理机制

## 安全考虑

### 文件访问安全
- 路径验证：确保只能访问存储目录内的文件
- 权限检查：验证用户操作权限
- 路径规范化：防止路径遍历攻击

### 数据安全
- 文件删除确认：重要操作需要用户确认
- 操作日志：记录所有文件操作
- 备份机制：重要文件删除前建议备份

## 性能优化

### 前端优化
- 分页加载：避免一次性加载大量数据
- 虚拟滚动：处理大量文件时的性能优化
- 缓存机制：缓存常用数据减少请求

### 后端优化
- 异步操作：文件操作使用异步处理
- 流式传输：大文件下载使用流式传输
- 索引优化：文件查询使用索引优化

## 部署配置

### 环境变量
```bash
STORAGE_PATH=/path/to/storage  # 存储根目录
```

### 目录结构
```
storage/
├── models/      # 模型文件
├── textures/    # 纹理文件
├── documents/   # 文档文件
└── temp/        # 临时文件
```

## 使用指南

### 管理员操作
1. **查看存储状态**: 进入存储空间管理页面查看当前存储使用情况
2. **管理文件**: 使用文件管理功能查看、搜索、删除文件
3. **清理空间**: 定期执行空间清理，释放存储空间
4. **配置设置**: 根据系统需求调整存储设置

### 最佳实践
- 定期监控存储空间使用率
- 及时清理临时文件和过期文件
- 设置合理的文件保留期限
- 定期备份重要文件

## 故障排除

### 常见问题
1. **存储信息获取失败**: 检查磁盘权限和存储路径配置
2. **文件删除失败**: 确认文件路径正确且具有删除权限
3. **清理操作超时**: 检查文件数量和系统性能

### 日志查看
- 后端日志：查看API请求和错误信息
- 前端控制台：查看JavaScript错误和网络请求

## 扩展功能

### 未来计划
- **文件压缩**: 自动压缩大文件节省空间
- **云存储集成**: 支持云存储服务
- **智能清理**: 基于AI的文件重要性分析
- **存储分析**: 详细的存储使用分析报告

## 技术栈

### 前端
- Vue 3 (Composition API)
- Element Plus UI组件库
- Axios HTTP客户端

### 后端
- Node.js
- Express.js
- fs.promises (文件系统操作)
- child_process (系统命令执行)

### 数据库
- 文件系统存储
- 可扩展为数据库存储配置信息

## 总结

存储空间管理模块为护橙河三维模型管理系统提供了完整的存储资源管理解决方案。通过直观的界面和强大的功能，帮助管理员有效管理存储空间，确保系统稳定运行。模块采用现代化的技术栈，具有良好的扩展性和维护性。
